<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}



</style><title>Scale - Visualizing and Rationalizing Musical Scales</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='scale---visualizing-and-rationalizing-musical-scales'><span>Scale - Visualizing and Rationalizing Musical Scales</span></h1><p><span>Albert Graef </span><a href='mailto:aggraef@gmail.com' target='_blank' class='url'>aggraef@gmail.com</a></p><p><span>July 2022</span></p><p><span>This is the Lua version of the Scale program. This program was first written around 2010 in the author&#39;s Pure programming language. However, the Pure version has since suffered from a crashing bug which affects applications using 3D rendering (as Scale does). Hence the port to a different language environment which doesn&#39;t have these issues. The Lua port aims for 100% compatibility with the Pure version. The graphical user interface, the functionality, and the file format are all virtually identical. The port is still new, though, it needs further testing and may still have bugs.</span></p><p><span>Why Lua? I enjoy programming in Lua. I think that it&#39;s a nifty little language with a good design and pretty syntax, very capable, yet easy to learn. It also has a light-weight runtime and is readily available on many platforms, which lets you get up and running quickly.</span></p><p><img src="scale.png" referrerpolicy="no-referrer" alt="The Scale program"></p><h2 id='introduction'><span>Introduction</span></h2><p><em><span>Scale</span></em><span> is a program for rationalizing and visualizing musical scales. The original version of this program was written in 2001 and documented in the author&#39;s </span><a href='http://www.musikinformatik.uni-mainz.de/schriftenreihe/nr45/scale.pdf' target='_blank'><span>report</span></a><span> &quot;Musical scale rationalization: a graph-theoretic approach&quot;, but this version isn&#39;t available on the web any more. The present version is a </span><a href='https://github.com/agraef/pure-lang/tree/master/pure-tk-examples/scale'><span>complete rewrite</span></a><span> in the </span><a href='https://agraef.github.io/pure-lang/' target='_blank'><span>Pure</span></a><span> programming language, now ported to </span><a href='https://www.lua.org/'><span>Lua</span></a><span>. Compared to the original version, it has a nicer GTK+ GUI (using </span><a href='https://dr-baum.net/gnocl/'><span>Gnocl</span></a><span>) and visualization component (using </span><a href='http://www.vtk.org/'><span>VTK</span></a><span>), and the automatic scale rationalization algorithm has been improved to make it easier to use.</span></p><p><span>The scale program generally computes </span><em><span>disharmonicities</span></em><span> using an additive measure which assigns basic &quot;indigestibility&quot; values to prime numbers. A simple example of this approach is Euler&#39;s </span><em><span>gradus suavitatis</span></em><span>, but the scale program provides various different measures derived from the works of Euler and the contemporary composer Clarence Barlow. (The notion of &quot;prime indigestibilities&quot; and the idea of automatic scale rationalization are in fact due to Barlow.)</span></p><p><span>The harmonic distance of two rational scale tones x and y is then given by the disharmonicity of the (rational) interval x/y. If this value is large then the interval contains many and/or large prime factors and is thus considered &quot;complex&quot; and &quot;disharmonious&quot;. Conversely, if the value is small then the interval is considered &quot;harmonious&quot; which means that the two involved scale tones x and y are closely related to each other.</span></p><p><span>As it turns out, the resulting notion of </span><em><span>harmonic distance</span></em><span> is actually a metric in the mathematical sense, and can thus be used to visualize the harmonic relationships in a scale. Moreover, harmonic distances also facilitate the manual or automatic generation of rationalizations of a given non-rational scale. Please see the author&#39;s </span><a href='http://www.musikinformatik.uni-mainz.de/schriftenreihe/nr45/scale.pdf' target='_blank'><span>report</span></a><span> for a detailed account on the theory behind this.</span></p><h2 id='copying'><span>Copying</span></h2><p><span>Copyright (c) 2010-2022 by Albert Gräf, all rights reserved.</span></p><p><span>The scale program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</span></p><p><span>The scale program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></p><p><span>Please see the accompanying COPYING file for the precise license terms.</span>
<span>The GPL can also be read online at </span><a href='http://www.gnu.org/licenses/' target='_blank' class='url'>http://www.gnu.org/licenses/</a><span>.</span></p><p><strong><span>NOTE:</span></strong><span> The sources include the file intnam.par which is Copyright (c) 2010 by Manuel Op de Coul (coul at huygens-fokker dot org) and redistributed here with his permission. The GNU General Public License does </span><em><span>not</span></em><span> apply to this file. The intnam.par file may only be redistributed unchanged with these sources, for any other use please write to coul at huygens-fokker dot org.</span></p><h2 id='prerequisites'><span>Prerequisites</span></h2><p><span>The scale program uses various 3rd party software for its GUI and numerical algorithms. You&#39;ll need:</span></p><ul><li><a href='https://www.lua.org/'><span>Lua</span></a><span> and </span><a href='https://github.com/kikito/inspect.lua'><span>inspect</span></a></li><li><a href='https://www.octave.org/'><span>Octave</span></a></li><li><a href='https://www.tcl.tk/'><span>Tcl/Tk</span></a><span> and </span><a href='https://dr-baum.net/gnocl/'><span>Gnocl</span></a></li><li><a href='https://www.vtk.org/'><span>VTK</span></a></li></ul><p><span>Except for VTK, you&#39;ll need fairly recent versions of all these. Lua 5.4, Octave 6.4, and Tcl/Tk 8.6 (+ Gnocl 0.9.96) have been tested and are known to work on Linux. For VTK I recommend using the older </span><a href='https://vtk.org/files/release/6.3/VTK-6.3.0.tar.gz'><span>VTK 6.3</span></a><span> version, which still includes the full set of VTK Tcl libraries, which are essential to use VTK in programming environments not directly supported by VTK, such as Lua.</span></p><p><span>Since ready-made packages for Gnocl and VTK 6.3 can be hard to find these days, I provide packages for Arch (</span><a href='https://aur.archlinux.org/packages?O=0&amp;K=gnocl'><span>Gnocl</span></a><span>, </span><a href='https://aur.archlinux.org/packages/vtk6-legacy'><span>VTK</span></a><span>) in the AUR (Arch User Repositories), and packages for Debian and Ubuntu (</span><a href='https://build.opensuse.org/project/show/home:aggraef:gnocl'><span>Gnocl</span></a><span>, </span><a href='https://build.opensuse.org/project/show/home:aggraef:vtk6'><span>VTK</span></a><span>) at the OBS (Open Build Service).</span></p><p><span>The program also requires Lua bindings to Tcl/Tk and Octave to work. Since I couldn&#39;t find anything suitable in the archives, I ported over the corresponding Pure modules. You can find these as </span><a href='https://github.com/agraef/lua-tk'><span>lua-tk</span></a><span> and </span><a href='https://github.com/agraef/lua-octave'><span>lua-octave</span></a><span> on GitHub. They can be installed as a </span><a href='https://luarocks.org/'><span>luarocks</span></a><span> module, or with </span><code>make &amp;&amp; sudo make install</code><span>. Please check the README files on GitHub for details.</span></p><p><span>Finally, you&#39;ll need </span><a href='https://github.com/kikito/inspect.lua'><span>inspect</span></a><span>. This is a popular 3rd-party module for pretty-printing arbitrary Lua data. If you don&#39;t have this installed, you can either get it using luarocks, or download it here: </span><a href='https://raw.githubusercontent.com/kikito/inspect.lua/master/inspect.lua'><span>inspect.lua</span></a><span>. You can also run </span><code>sudo make install-inspect</code><span> to have this done automatically; it will check whether the module is installed already, and copy the module to the proper directory on Lua&#39;s package path if needed.</span></p><p><span>Currently the program is only known to work on Linux. Porting to other platforms won&#39;t be a piece of cake, but is certainly doable. Ready-made binaries for Lua, Tcl/Tk, VTK, and Octave exist on a variety of platforms, but getting these to work together nicely might be a challenge on some systems like Mac and Windows. (At the very least, you&#39;ll have to port lua-tk and lua-octave, and get hold of suitable builds of Gnocl and VTK for your platform.) If you do, please let us know.</span></p><h2 id='installation'><span>Installation</span></h2><p><span>There is no need to install this program, you can just run it from the source directory as </span><code>lua scale.lua</code><span> or </span><code>./scale.lua</code><span>, or use </span><code>ln -s</code><span> to create a symlink to </span><code>scale.lua</code><span> in some directory on your path, in order to run it from anywhere.</span></p><p><span>For a system-wide install, you can run the usual </span><code>sudo make install</code><span>, which will put the script and data files under </span><code>/usr/local/share/scale</code><span>, and create a link to the </span><code>scale.lua</code><span> script named </span><code>/usr/local/bin/scale</code><span>, so that you can launch the program by just typing </span><code>scale</code><span>. The default installation prefix </span><code>/usr/local</code><span> can also be adjusted as needed by setting the </span><code>prefix</code><span> variable in the Makefile accordingly. To uninstall the program at a later time, just type </span><code>sudo make uninstall</code><span>.</span></p><h2 id='usage'><span>Usage</span></h2><p><span>The scale program reads and writes files in the </span><a href='http://www.huygens-fokker.org/scala/'><span>Scala</span></a><span> scale file format. (The Scala file format is the de facto standard for musical scale data. Please check the Scala website for details on Scala and its big repository of scale files.) To open a scale (.scl) file, use the </span><code>Open</code><span> button in the main window, or specify the file on the command line, e.g.:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./scale.lua scl/b12tone.scl</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The main window is divided into two panes, a notebook widget with the </span><code>Graph</code><span>, </span><code>Scale</code><span> and </span><code>Metric</code><span> tabs in the upper half, and a box with various entry fields, global parameter values, a strip of buttons and a status line in the lower half. The status line gives feedback during operations which may take a while to complete (in particular, when drawing and rationalizing a scale). The </span><code>Graph</code><span> tab displays a 3-dimensional rendering of the scale. The </span><code>Scale</code><span> and </span><code>Metric</code><span> tabs have additional related information about the scale points and the disharmonicity metric of the scale.</span></p><p><span>You can also invoke the scale program with the </span><code>-g</code><span> option to have the graph view displayed in a separate window, in which case the controls on the </span><code>Graph</code><span> tab can be found in the main window instead. This mode improves portability, as embedding a VTK view might not be supported on all platforms. It also enables you to look at the graph and the scale or metric view at the same time.</span></p><p><span>Scales can be loaded and saved with the </span><code>Open</code><span> and </span><code>Save</code><span> buttons at the bottom of the main window, see </span><a href='#file-operations'><span>File Operations</span></a><span> below for details. If you load a plain Scala file, you will be prompted if you first want to draw it. This is also needed to generate some useful information on the </span><code>Scale</code><span> and </span><code>Metric</code><span> tabs, so you should answer </span><code>Yes</code><span> there. You can also just enter a scale in Scala format (ratios as p/q where p and q are positive integers, cent values as nonnegative floating point values) in the upper entry field in the lower half of the main window, and then click the </span><code>Draw</code><span> button to render the scale. Some already rendered examples are included in the scl subdirectory in the sources, so have a look at those to get an idea how this works.</span></p><p><span>Note that the </span><code>Graph</code><span> and </span><code>Metric</code><span> tabs will only have interesting information if all scale points are rational; this is required to compute the disharmonicity metric. In this case the scale display shows an approximation of the harmonic distances of the scale points in three-dimensional Euclidean space, computed using a multidimensional scaling (MDS) algorithm (also described in the author&#39;s </span><a href='http://www.musikinformatik.uni-mainz.de/schriftenreihe/nr45/scale.pdf' target='_blank'><span>report</span></a><span>). The necessary operations to create a rational scale from any input scale are provided, see </span><a href='#rationalizing-a-scale'><span>Rationalizing a Scale</span></a><span> below.</span></p><p><span>To exit the program, click the </span><code>Quit</code><span> button at the right end of the button strip (equivalently, you can also use the </span><code>Alt-Q</code><span> keyboard shortcut), or just close the main window. The </span><code>About</code><span> button in the lower part of the main window (keyboard shortcut: </span><code>Alt-B</code><span>) shows some useful information about the program, while the </span><code>Help</code><span> button (keyboard shortcut: </span><code>Alt-H</code><span>) displays this manual in a web browser.</span></p><h2 id='file-operations'><span>File Operations</span></h2><p><span>The file operations can be found in the button strip at the bottom of the main window.</span></p><ul><li><code>New</code><span>, </span><code>Open</code><span>, </span><code>Save</code><span>: Creates a new, loads an existing, or saves the current scale, respectively. With the latter two commands you are prompted to enter a scale (.scl) filename.</span></li><li><code>Revert</code><span>: Reverts to the most recently saved version of the loaded scale. This provides a quick way to revert your changes after editing the scale or experimenting with different scale rationalizations.</span></li><li><code>Quit</code><span>: Exit the application.</span></li></ul><p><span>Holding the </span><code>Alt</code><span> key underlines the available keyboard shortcuts in the button texts. So, e.g., the </span><code>Open</code><span> command can be invoked with </span><code>Alt-O</code><span>, </span><code>Save</code><span> with </span><code>Alt-S</code><span>, etc.</span></p><p><span>The scale program can also save scales as binary sysex (.syx) files in the </span><a href='https://www.midi.org/specifications/midi1-specifications/midi-1-addenda/midi-tuning-updated' target='_blank'><span>MIDI Tuning Standard</span></a><span> (MTS) format, so that you can easily retune any MTS-compatible synthesizer to a scale by just sending the corresponding sysex file to it. Currently this only works with octave-based scales which have exactly 13 scale points (including the base tone 1/1 and the octave 2/1). The written sysex files follow the </span><em><span>MIDI Tuning Scale/Octave Extensions</span></em><span>, please check the MTS documentation for details.</span></p><p><span>To save a scale as a sysex file, simply invoke the </span><code>Save</code><span> operation as usual. When prompted to enter the scale filename, edit the filename so that it ends in the extension </span><code>.syx</code><span>, then press </span><code>Save</code><span>. A special dialog will appear which allows you to choose various MTS format options. Adjust these to your liking and press </span><code>Save</code><span> again (you can also cancel the operation at this point). The available MTS format options are as follows:</span></p><ul><li><code>Realtime</code><span>: If this option is checked, a realtime sysex message will be written, otherwise a non-realtime message. Note that in either case, the tuning changes will take effect immediately if the sysex file is sent to an MTS-capable synthesizer. However, realtime messages will also affect already sounding notes, whereas non-realtime messages only apply to new notes played after the message is sent.</span></li><li><code>Encoding</code><span>: This is a combobox which allows you to pick the desired encoding of the MTS message. MTS octave tunings can be encoded in either 1-byte or 2-byte format, meaning that each tuning offset is represented as one or two bytes, respectively. This affects both range and precision of the tuning offsets, please check the MTS documentation for details. Usually it is a good idea to pick the 2-byte encoding, since it offers a wider range (-100..+100 ct) and better precision. However, if your synthesizer only supports the 1-byte encoding, or if you are really concerned about transmission bandwidth then it may be necessary to choose the 1-byte encoding instead. (Note that 2-byte messages need roughly twice the size of 1-byte messages; this may affect how quickly the messages are processed, although this is rarely a problem with modern hardware any more).</span></li><li><code>Base</code><span>: This spinbox enables you to select the reference tone of the tuning, given as the index of a scale point in the range 0..11. A value of 0 indicates that the base tone of the scale will be at its nominal tuning (i.e., at a tuning offset of 0 ct). The spinbox allows you to change this as needed. Most of the time, you will want to choose the value 9 to have the 9th scale tone (which usually corresponds to the chamber pitch A) at a tuning offset of 0 ct, so that A4 will be exactly at 440 Hz; this shifts the other tuning offsets accordingly.</span></li></ul><p><span>By default, realtime messages and 2-byte encodings are enabled, and the base tone is set to 9, which should be sensible defaults in most cases.</span></p><p><span>Note that in order to actually use the resulting sysex files, you need an MTS-compatible synthesizer. Unfortunately, the MIDI Tuning Standard isn&#39;t supported by many hardware synthesizers, so you&#39;ll probably have to use a software synthesizer instead. A good MTS-compatible software synthesizer is </span><a href='http://www.fluidsynth.org/'><span>Fluidsynth</span></a><span> which uses SoundFonts and has a nice graphical frontend called </span><a href='http://qsynth.sourceforge.net'><span>Qsynth</span></a><span>. It is available for Linux, Mac OS X and Windows.</span></p><p><span>In addition, you&#39;ll need a program which can read sysex files and transmit them to the synthesizer. There are many such programs freely available for different platforms, such as </span><a href='https://github.com/Manuel-K/SimpleSysexxer'><span>Simple Sysexxer</span></a><span> on Linux and </span><a href='http://www.midiox.com/'><span>Midi-Ox</span></a><span> on Windows. Also, many MIDI sequencing programs have this capability.</span></p><h2 id='editing-the-scale'><span>Editing The Scale</span></h2><p><span>At the bottom of the main window there are two entry fields. The first field is for the scale itself, while the second one is for a short plain text description of the scale. You can write anything in the second field (you can also just leave it empty), but the scale data must follow the Scala conventions:</span></p><ul><li><span>A quotient in the form </span><code>p/q</code><span>, where </span><code>p</code><span> and </span><code>q</code><span> are positive integer values, denotes an interval by its frequency ratio, e.g.: </span><code>1/1</code><span> (unison), </span><code>3/2</code><span> (fifth), </span><code>2/1</code><span> (octave), etc.</span></li><li><span>A nonnegative floating point value such as </span><code>0.0</code><span>, </span><code>701.955</code><span> or </span><code>1200.0</code><span> denotes a Cent value (percent of an equal-tempered semitone).</span></li></ul><p><span>No other values are allowed in this field. Different scale tones are usually entered in ascending order, starting with the base tone </span><code>1/1</code><span> or </span><code>0.0</code><span>, with whitespace in between. For instance: </span><code>1/1 100.0 3/2 1200.0</code><span>.  (Note that the base tone is implicit in the Scala file format, so it is not actually stored in scale files. That&#39;s why even if you don&#39;t enter the base tone it will be added automatically.)</span></p><p><span>To the right of the scale entry field there&#39;s another control, the &quot;weight threshold&quot; spinbox which allows you to enter a harmonic distance threshold used to render the scale graph in the </span><code>Graph</code><span> tab, and to determine rational tuning alternatives in the </span><code>Scale</code><span> view. You&#39;ll have to adjust this value accordingly when drawing or rationalizing a scale.</span></p><h2 id='the-graph-view'><span>The Graph View</span></h2><p><span>Once a scale has been entered or loaded, you can draw it by pushing the </span><code>Draw</code><span> button on the </span><code>Graph</code><span> tab. This produces a graphical rendering of the scale. The graphical rendering is also stored in the scale file when you save it. Next time you load this file, the same graphical view is recreated automatically.</span></p><p><span>If the scale contains any Cent values, the graphical display is a simple chain of the scale points in the order in which they are given. If all scale points are rational, however, then you&#39;ll see a proper 3-dimensional rendering of the scale, called a &quot;harmonicity graph.&quot; The nodes of this graph are the scale points and the edges represent color-coded harmonic distances between some pairs of scale points (see below).</span></p><p><span>Note that the graphical rendering isn&#39;t arbitrary, but approximates the harmonic distances (shown on the </span><code>Metric</code><span> tab) between scale points by their Euclidean distances in the drawing, so that it becomes easy to analyse the harmonic relationships in the scale. This is achieved using a technique called &quot;multidimensional scaling&quot; (MDS), see the author&#39;s </span><a href='http://www.musikinformatik.uni-mainz.de/schriftenreihe/nr45/scale.pdf' target='_blank'><span>report</span></a><span> for details.</span></p><p><span>The graphical view can be rotated, panned and zoomed with the mouse, so that you can take a look at the scale from all angles. To these ends, press a mouse button in the graph window (left for rotation, middle for panning, right for zooming) and, with the mouse button still pressed, move the mouse cursor in any direction. Moving the mouse cursor with the left or middle button pressed rotates or moves the view in the corresponding direction. To zoom in and out, with the right mouse button pressed move the mouse cursor up and down, respectively.</span></p><p><span>If the graph view is shown in a separate window, and the window has the keyboard focus, the following keyboard commands are recognized:</span></p><ul><li><code>r</code><span>: Resets the view to the default camera position (horizontal x and vertical y axis, with positive z coordinates in front).</span></li><li><code>j</code><span>: Switches to an alternative &quot;joystick&quot; mode in which you only have to press the left/right/middle mouse button inside the view to rotate/pan/zoom.</span></li><li><code>t</code><span>: Switches back to the default &quot;trackball&quot; mode in which you drag the mouse cursor with the left/right/middle mouse button to rotate/pan/zoom.</span></li></ul><p><span>Various controls for the display can be found in the strip at the bottom of the </span><code>Graph</code><span> pane (or in the main window below the </span><code>Scale</code><span>/</span><code>Metric</code><span> pane if the graph is shown in a separate window):</span></p><ul><li><code>Draw</code><span>: Updates the scale information and redraws the scale.  Progress will be shown in the progress bar in the main window (to the right of the scale description field). You can run this as often as you want, e.g., after editing the scale. Also, note that the MDS algorithm starts from a random start embedding, so for some scales you might get different renderings when you redraw the scale.</span></li><li><code>Reset</code><span>: Reset the camera position (same as the </span><code>r</code><span> key in the graphical view, see above).</span></li><li><code>Axes</code><span>: Enables or disables x, y and z axes display in the view.</span></li><li><code>Labels</code><span>: Enables or disables the node label display which shows information about the scale points in the graph.</span></li><li><code>Node label type</code><span>: A combobox which lets you choose between &quot;Pitch&quot; (show ratios or cent values; this is the default), &quot;Factors&quot; (prime factors of ratios), &quot;Cent&quot; (cent values), &quot;Note&quot; (note names, if known), &quot;Interval&quot; (interval descriptions, for known intervals) and &quot;Ordinal&quot; (scale index). These items have the same meaning as the corresponding columns on the </span><code>Scale</code><span> tab, see </span><a href='#the-scale-view'><span>The Scale View</span></a><span> below for details.</span></li><li><code>Weights</code><span>: Enables or disables the edge weight display, which shows the harmonic distances between scale points.</span></li><li><code>Edge weight function</code><span>: A combobox which lets you choose between various harmonic distance functions, currently: &quot;Barlow&quot; (Barlow&#39;s indigestability metric) and &quot;Euler&quot; (Euler&#39;s gradus suavitatis). The other functions are variations of these (the &quot;/2&quot; versions set the harmonic distance of octaves to zero, and the &quot;Log&quot; variations take the decadic logarithm of the Euler and Barlow metrics). Changing the weight function produces different drawings and information on the Scale and Metric tabs, so you&#39;re prompted to redraw the scale when changing this value.</span></li></ul><p><span>Besides these, the already mentioned &quot;weight threshold&quot; spinbox to the right of the scale entry field also influences the display of the harmonicity graph. Only those edges between scale points will be drawn whose harmonic distance does not exceed the value given in the spinbox. Moreover, the edges are color-coded (blue denotes low, red high harmonic distances).</span></p><h2 id='the-scale-view'><span>The Scale View</span></h2><p><span>The </span><code>Scale</code><span> tab shows detailed information about the current scale in the form of a table whose columns include the following information:</span></p><ul><li><code>Select</code><span>: This column allows you to select pitches for the rationalization algorithm, see the comments below and </span><a href='#rationalizing-a-scale'><span>Rationalizing a Scale</span></a><span> for details.</span></li><li><code>#</code><span>: Ordinal numbers (starting at zero = base tone).</span></li><li><code>Pitch</code><span>: The ratio or cent value, as given in the scale entry field.</span></li><li><code>Factors</code><span>: The factorization of the pitch, if it is rational.</span></li><li><code>Cent</code><span>: The corresponding cent value.</span></li><li><code>Weight</code><span>: The disharmonicity value of the interval (for rational pitches only), as given by the weight function on the </span><code>Graph</code><span> tab.</span></li><li><code>Note</code><span>: The note name, if available.</span></li><li><code>Interval</code><span>: The name of the interval from the Scala intnam.par file, if available.</span></li></ul><p><span>Note names are computed automatically from a factorization of the ratios, assuming a &quot;standard&quot; tuning for the prime factors. At present, this is only implemented for rational pitches with the prime factors 2, 3, 5, 7 and 11, i.e., for &quot;11-limit&quot; pitches. 1/1 always denotes the base note C, and the other note names are computed relative to that.</span></p><p><span>The first column in the scale view allows you to select both scale points and the corresponding tuning alternatives. Selected scale points are considered &quot;locked&quot; for the purpose of scale rationalization. By default, all scale points are selected which are rational already. Also, for scale points for which alternative tunings are available, there is a tiny arrowhead in this column. Clicking on the arrowhead symbol expands the corresponding scale point and shows the available candidate tunings.</span></p><p><span>You can also click on the column headers to sort the scale view based on the values in the corresponding column. This is most useful for the numeric columns (</span><code>#</code><span>, </span><code>Cent</code><span> and </span><code>Weight</code><span>). By default, the table is ordered by ordinals (</span><code>#</code><span>), meaning that the scale points are listed in the order in which they are written in the scale entry field. Clicking on a column title once sorts the table in ascending order. Clicking the same column title again reverses the order so that the values in the column are listed in descending order.</span></p><p><span>At the bottom of the </span><code>Scale</code><span> tab there is a strip with operations and parameters for selecting scale points and alternative tunings and controlling the rationalization algorithm:</span></p><ul><li><code>Clear</code><span>: Deselect all scale points and alternative tunings.</span></li><li><code>Select All</code><span>: Select all candidate tunings for which the corresponding scale point is </span><em><span>not</span></em><span> selected (i.e., unlocked).</span></li><li><code>Refresh</code><span>: Refresh the scale display (in particular, this updates the available candidate tunings). This is usually done after changing the number of candidate tunings and tuning tolerance parameters (see below) as well as the weight threshold parameter in the main window.</span></li><li><code>Number of tuning alternatives</code><span>: A spinbox which allows you to select the maximum number of alternative tunings to be shown for each scale point.</span></li><li><code>Tuning tolerance</code><span>: Another spinbox with which you choose the maximum tuning tolerance for the alternative tunings for each scale point.</span></li><li><code>Rationalization heuristic</code><span>: This lets you choose between different candidate tuning selection heuristics for the automatic rationalization algorithm. The present implementation provides two alternatives, &quot;First&quot; and &quot;Best&quot;.</span></li><li><code>Rationalize</code><span>: Automatic scale rationalization algorithm.</span></li><li><code>Update</code><span>: After selecting some alternative tunings, clicking this button updates and redraws the scale in the main window accordingly.</span></li></ul><p><span>Besides these, the &quot;weight threshold&quot; spinbox to the right of the scale entry field determines which tuning alternatives are shown for each scale point. Only tuning alternatives with a disharmonicity value of at most the threshold value are shown. Moreover, for each scale point the table shows at most n tuning alternatives in the range c-tol ... c+tol, where c is the cent value of the scale point (as given in the </span><code>Cent</code><span> column of the table), and tol and n are the tuning tolerance and the number of tuning alternatives, as given by the corresponding spinboxes.</span></p><p><span>The order of the alternative tunings for each scale tone depends not only on their nominal disharmonicity values but also on their absolute deviation from the scale point in cents. To these ends, the scale program computes &quot;weighted&quot; disharmonicity values using a formula by Barlow, described in the </span><a href='http://www.musikinformatik.uni-mainz.de/schriftenreihe/nr45/scale.pdf' target='_blank'><span>report</span></a><span>.  (The idea behind this is that the nominal disharmonicity values are scaled using a Gaussian bell curve which has its center at the current pitch of the scale point in Cents.) The first tuning alternative shown for a scale point is thus the &quot;best&quot; rational approximation of the scale tone according to this criterion, which is a compromise between harmonicity and tuning accuracy.</span></p><h2 id='the-metric-view'><span>The Metric View</span></h2><p><span>For rational scales, the </span><code>Metric</code><span> tab shows the harmonic distance metric used in drawing and rationalizing a scale. It takes the form of a matrix which shows for each pair x,y of scale points their harmonic distance, i.e., the disharmonicity of the interval x/y between the scale points. The weight function used to determine these values can be chosen with the &quot;edge weight function&quot; combobox on the </span><code>Graph</code><span> tab.</span></p><h2 id='rationalizing-a-scale'><span>Rationalizing a Scale</span></h2><p><span>If a scale isn&#39;t rational yet then it is not possible to analyze the interval structure of a scale since this requires knowing the rational relationships between the scale tones. On the </span><code>Scale</code><span> tab you find the necessary tools to rationalize a scale using the following methods:</span></p><ul><li><em><span>Manual rationalization</span></em><span>: Here you simply select the desired rational tuning alternatives for each scale tone and then use </span><code>Update</code><span> to update the scale data and redraw the scale. You can select more than one tuning alternative for each scale tone. In such a case the first alternative will be chosen, depending on the current order of the alternatives in the table. Thus the easiest way to quickly obtain a rationalization is to just click </span><code>Select All</code><span> and then </span><code>Update</code><span>.</span></li><li><em><span>Automatic rationalization</span></em><span>: This uses a clique search algorithm on the harmonicity graph to determine a collection of selected tuning alternatives (at most one per scale point) for which the mutual harmonic distances do not exceed the bound given in the &quot;weight threshold&quot; spinbox. The selection of the tuning alternatives is then modified to reflect the computed solution. When done, just click </span><code>Update</code><span> as with the manual method to update the scale using the computed solution.</span></li></ul><h3 id='fixing-parts-of-the-scale'><span>Fixing Parts of the Scale</span></h3><p><span>With either method, selected scale points are considered </span><em><span>locked</span></em><span>, i.e., they will not be modified by </span><code>Rationalize</code><span> and </span><code>Update</code><span>. (However, the automatic rationalization algorithm does take into account locked </span><em><span>rational</span></em><span> scale points when computing the eligible tuning alternatives.) By default, rational scale points are selected and thus considered locked. If you want to re-rationalize these as well, you first need to deselect them in order to unlock them. The quickest way to do this is to click the </span><code>Clear</code><span> button which deselects all scale points (as well as all tuning alternatives). Then use </span><code>Select All</code><span> to select all tuning alternatives (or select the ones that you want manually) before running </span><code>Rationalize</code><span> and/or </span><code>Update</code><span>.</span></p><h3 id='automatic-rationalization'><span>Automatic Rationalization</span></h3><p><span>The </span><code>Rationalize</code><span> command employs a backtracking clique search algorithm which explores exponentially many possibilities in the worst case and thus may be </span><em><span>very</span></em><span> slow, depending on the number of available tuning alternatives. To deal with this, you may try to restrict the number of tuning alternatives or fix some tunings manually beforehand.</span></p><p><span>You can also just run the algorithm and interrupt it at any time by hitting the </span><code>Rationalize</code><span> button (which is now labelled </span><code>Interrupt</code><span>) again. The progress of the algorithm towards an optimum solution which rationalizes all unlocked scale points is shown in the progress bar in the main window. Usually, the algorithm will converge to a local optimum pretty quickly (indicated by no further changes in the progress bar), at which point you may interrupt the algorithm and see whether the computed solution provides at least a viable partial rationalization of the scale.</span></p><p><span>The rationalization algorithm can also be adjusted by employing different search heuristics. You can find these in the </span><code>Rationalization heuristic</code><span> combobox. In the current program version, only two search heuristics are provided:</span></p><ul><li><code>First</code><span>: Scale points and tuning alternatives are considered in the order in which they are shown in the table. This strategy works pretty well if enough &quot;good&quot; candidate tunings are available and is the default.</span></li><li><code>Best</code><span>: This strategy selects tuning alternatives dynamically in order to minimize the total disharmonicity in the chosen rationalization. This tends to produce overall better solutions, but is slower than the </span><code>First</code><span> strategy and may also produce &quot;funny&quot; tunings for some scale points at times.</span></li></ul><p><span>Future versions of the program may add more search heuristics as we find new ways to guide the search towards good solutions. But note that the scale rationalization problem is inherently difficult (NP-hard in computer science parlance, see the </span><a href='http://www.musikinformatik.uni-mainz.de/schriftenreihe/nr45/scale.pdf' target='_blank'><span>report</span></a><span> for details) and thus no search heuristic can guarantee to find good solutions quickly in all cases (unless P=NP, of course, but this is considered very unlikely by most experts).</span></p><h3 id='performing-a-rationalization'><span>Performing a Rationalization</span></h3><p><span>To summarize, here is an outline of the basic steps of the rationalization process:</span></p><ol start='0' ><li><span>Make sure that the current scale is saved, so that you can easily reload it and start over if things go awry.</span></li><li><span>Choose a weight threshold value (and possibly a tuning tolerance and a number of tuning alternatives) and do a </span><code>Refresh</code><span> until a suitable set of tuning alternatives is shown.</span></li><li><span>Select the scale points that you want to stay fixed, and deselect the ones that you want to be rationalized. By default, all rational scale points are selected already which is often a sensible choice, so you can skip this step if you&#39;re content with the default selection. You can also use </span><code>Clear</code><span> if you want to just re-rationalize everything.</span></li><li><span>Select the eligible tuning alternatives. Or just do </span><code>Select All</code><span> to select all tuning alternatives. (This also expands the corresponding scale points if necessary to show all selected alternatives.)</span></li><li><span>Use </span><code>Rationalize</code><span> to try an automatic rationalization. (Hit the same button again to interrupt it if it takes too long.) You might need to increase the weight threshold and/or fine-tune the selection of tuning alternatives to obtain a satisfactory result using this method. (If you already selected some suitable tuning alternatives that you want to use, you can also just skip this step and directly proceed to step 5.)</span></li><li><span>Use </span><code>Update</code><span> to update the scale and redraw it.</span></li><li><span>If all scale tones are rational now then you&#39;re done. Otherwise, just repeat the steps 1-5 above until you&#39;re satisfied with the result.</span></li><li><span>If the solution you got is not what you wanted, just use </span><code>Revert</code><span> to revert to the original version of the scale and start over.</span></li></ol></div></div>
</body>
</html>